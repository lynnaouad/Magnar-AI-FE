<div class="prompt-page-container">
  <div class="chat-container">
    <!-- Empty state -->
    <div *ngIf="messages.length === 0" class="empty-state">
      <!-- Fixed header -->
      <div class="chat-header">
        <h3>{{ "AskAI" | translate }}</h3>
      </div>

      <h2>{{ "WhatAreYouWorkingOn" | translate }}</h2>

      <form class="empty-input-wrapper" (submit)="onPromptSubmit($event)">
        <dx-text-area
          [(value)]="data.prompt"
          valueChangeEvent="input"
          [maxHeight]="250"
          [autoResizeEnabled]="true"
          [placeholder]="'PlaceHolders.AskAIDescription' | translate"
          stylingMode="filled"
          class="empty-input"
        >
        </dx-text-area>

        <dx-button
          class="send-btn"
          icon="send"
          type="default"
          stylingMode="contained"
          [useSubmitBehavior]="true"
          [disabled]="!data.prompt?.trim()"
        ></dx-button>
      </form>
    </div>

    <!-- Chat state -->
    <ng-container *ngIf="messages.length > 0">
      <!-- Messages -->
      <div class="messages-window" #messagesWindow>
        <div
          *ngFor="let msg of messages"
          class="message-wrapper"
          [ngClass]="msg.role"
        >
          <div class="message-bubble">
            <div class="message-role">
              {{
                msg.role === "user" ? ("You" | translate) : ("MagnarAI" | translate)
              }}

              <!-- Copy button only for AI -->
              <button
                *ngIf="msg.role === 'assistant'"
                class="copy-btn"
                (click)="utilityService.copyToClipBoard(msg.content)"
              >
                <i class="dx-icon dx-icon-copy"></i>
              </button>
            </div>

            <div class="message-text">{{ msg.content }}</div>
          </div>
        </div>

        <dx-load-indicator
          class="chat-loader"
          *ngIf="generateLoading"
          height="32"
          width="32"
        ></dx-load-indicator>
      </div>

      <!-- Prompt input -->
      <form class="chat-input-wrapper" (submit)="onPromptSubmit($event)">
        <dx-text-area
          [(value)]="data.prompt"
          valueChangeEvent="input"
          [maxHeight]="250"
          [autoResizeEnabled]="true"
          [placeholder]="'PlaceHolders.AskAIDescription' | translate"
          stylingMode="filled"
          class="chat-input"
        >
        </dx-text-area>

        <!-- Toggle button -->
        <dx-button
          *ngIf="!generateLoading"
          class="send-btn"
          icon="send"
          type="default"
          stylingMode="contained"
          [useSubmitBehavior]="true"
          [disabled]="!data.prompt?.trim()"
        ></dx-button>

        <dx-button
          *ngIf="generateLoading"
          class="stop-btn"
          icon="square"
          type="default"
          stylingMode="contained"
          (onClick)="onStop()"
        ></dx-button>
      </form>
    </ng-container>
  </div>
</div>
